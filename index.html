<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Telegram Mario</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #2c3e50;
            touch-action: manipulation;
            font-family: Arial, sans-serif;
        }

        #gameContainer {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #gameCanvas {
            image-rendering: crisp-edges;
            width: 100%;
            height: 100%;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 100;
        }

        .btn {
            padding: 15px 25px;
            font-size: 18px;
            background: #27ae60;
            border: none;
            color: white;
            border-radius: 10px;
            touch-action: none;
        }

        #coins {
            position: fixed;
            top: 15px;
            left: 15px;
            color: white;
            font-size: 20px;
            background: rgba(0,0,0,0.5);
            padding: 10px 15px;
            border-radius: 10px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div id="coins">üí∞: 0</div>
        <div class="controls">
            <button class="btn" id="restartBtn">üîÑ –†–µ—Å—Ç–∞—Ä—Ç</button>
            <button class="btn" id="soundBtn">üîä –ó–≤—É–∫</button>
        </div>
    </div>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã
        let gameState = {
            coins: 0,
            running: false,
            mario: null,
            obstacles: [],
            coinsArray: [],
            speed: 5,
            sound: true
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
        const assets = {
            mario: new Image(),
            coin: new Image(),
            obstacle: new Image(),
            background: new Image()
        };

        assets.mario.src = 'mario.png';
        assets.coin.src = 'coin.png';
        assets.obstacle.src = 'obstacle.png';
        assets.background.src = 'background.png';

        // –ö–ª–∞—Å—Å—ã –æ–±—ä–µ–∫—Ç–æ–≤
        class Mario {
            constructor() {
                this.x = 50;
                this.y = canvas.height - 150;
                this.width = 80;
                this.height = 80;
                this.gravity = 0.8;
                this.velocity = 0;
                this.jumpForce = -18;
                this.grounded = true;
            }
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∏ –ª–æ–≥–∏–∫–∞ –∏–≥—Ä—ã...

        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        document.addEventListener('touchstart', (e) => {
            if(gameState.running) gameState.mario.jump();
            e.preventDefault();
        }, {passive: false});

        document.getElementById('restartBtn').addEventListener('click', initGame);
        document.getElementById('soundBtn').addEventListener('click', toggleSound);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
            gameState = {
                coins: 0,
                running: true,
                mario: new Mario(),
                obstacles: [],
                coinsArray: [],
                speed: 5,
                sound: true
            };
            
            requestAnimationFrame(gameLoop);
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if(!gameState.running) return;
            
            // –õ–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏...
            
            requestAnimationFrame(gameLoop);
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = () => {
            Promise.all(Object.values(assets).map(img => 
                new Promise(resolve => {
                    img.onload = resolve;
                    img.onerror = resolve;
                })
            )).then(initGame);
        };

        // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram
        tg.onEvent('viewportChanged', () => {
            canvas.width = tg.viewportWidth;
            canvas.height = tg.viewportHeight;
        });
    </script>
</body>
</html>
